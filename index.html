<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KeyboardStart</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<header></header>
<main>
    <div class="wrapper" id="main"></div>
</main>
<footer></footer>

<script>
    var keys = {
        0: ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
        1: ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
        2: ['z', 'x', 'c', 'v', 'b', 'n', 'm'],
        length: 3
    };

    var hash = {
        z: 'http://zhihu.com',
        j: 'http://juejin.im',
        e: 'http://ele.me',
        a: 'http://alibaba.com',
        q: 'http://qq.com'
    };

    //取出LocalStorage'zzz'中的对应内容
    hashInLocalStorage = JSON.parse(localStorage.getItem('zzz')||'null');
    if(hashInLocalStorage){
        hash = hashInLocalStorage;
    }


    //遍历keys，生成kbd标签
    index = 0;
    while (index < keys['length']) {
        div = document.createElement('div');
        div.className = 'row';//div的class名
        main.appendChild(div);
        row = keys[index];//第1  2  3 个数组
        index2 = 0;
        while (index2 < row.length) {
            kbd = document.createElement('kbd');
            span = document.createElement('span');
            span.className = 'text';
            span.textContent = row[index2];
            kbd.appendChild(span);
            kbd.className = 'key';//设置键盘样式
            button = document.createElement('button');//button是一个容器,在这26次循环中，只有一个button
            button.textContent = 'Edit';
            button.style.borderRadius = '3px';
            button.id = row[index2];
            img = document.createElement('img');
            if(hash[row[index2]]){
                img.src = hash[row[index2]]+'/favicon.ico';//图标获取
            }else{
                img.src = '//i.loli.net/2017/11/10/5a05afbc5e183.png'//默认图片
            }
            img.onerror = function (ev) {
                ev.target.src = '//i.loli.net/2017/11/10/5a05afbc5e183.png';
            };//网址加载失败，拿不到图标，显示默认图片
            button.onclick = function (ev) {
                button2 = ev.target;
                img2 = button2.previousSibling;
                pressKey = button2['id'];//被用户点击的按钮 q w e ...
                newWebsite = prompt('请输入网址');
                hash[pressKey] = newWebsite;//hash变更
                img2.src = 'http://'+newWebsite+'/favicon.ico';
                img2.onerror = function (ev) {
                    ev.target.src = '//i.loli.net/2017/11/10/5a05afbc5e183.png';
                };
                localStorage.setItem('zzz',JSON.stringify(hash));// localStorage有很多桶，目前hash存于zzz桶里，做备份的过程
            };
            kbd.appendChild(img);
            kbd.appendChild(button);
            div.appendChild(kbd);
            index2++;
        }
        index++;
    }


    document.onkeypress = function (ev) {
        key = ev['key'];//用户按了什么键
        website = hash[key];//拿到键对应的网站
        window.open(website,'_blank');//新窗口打开网站
    }


</script>
</body>
</html>